% move all configuration stuff into one file so we can focus on the content
\input{include}


\subtitle{Part 15: Digital Filters I}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
    % generate title page
	\input{titlepage}

\section[intro]{introduction}
	\begin{frame}{filters}{introduction 1/2}
        \begin{block}{filter --- broad description}
            system that amplifies or attenuates certain components/aspects of a signal
        \end{block}
        \pause
        \bigskip
        \begin{block}{filter --- narrow description}
            linear time-invariant system for changing the magnitude and phase of specific frequency regions            
        \end{block}
        \pause
        \bigskip
        \begin{itemize}
            \item   example for other type of filters:
                \begin{itemize}
                    \item	adaptive  and time-variant (e.g., denoising)
                \end{itemize}
            \item	examples for ``real-world'' filters
                \begin{itemize}
                    \item	reverberation
                    \item	absorption
                    \item	echo
                \end{itemize}
        \end{itemize}
	\end{frame}
	\begin{frame}{filters}{introduction 2/2}
        \vspace{-5mm}
        \begin{columns}
            \column{.5\linewidth}
                \begin{itemize}
                    \item   \textbf{audio equalization}
                        \begin{itemize}
                            \item   parametric and graphic EQs
                        \end{itemize}
                    \smallskip
                    \item<2->   \textbf{removal} of unwanted components
                        \begin{itemize}
                            \item   remove DC, rumble, hum, hiss
                        \end{itemize}
                    \smallskip
                    \item<3->   \textbf{pre-emphasis/de-emphasis}
                        \begin{itemize}
                            \item   Vinyl
                            \item   old  noise reduction systems
                        \end{itemize}
                    \smallskip
                    \item<4->   \textbf{weighting} function
                        \begin{itemize}
                            \item   dBA, dBC, \ldots
                        \end{itemize}
                    \smallskip
                    \item<5->   (parameter) \textbf{smoothing}
                        \begin{itemize}
                            \item   smooth sudden changes
                        \end{itemize}
                \end{itemize}
                \vspace{70mm}
            \column{.5\linewidth}
                \only<1>{
                    \begin{figure}
                        \includegraphics[scale=.15]{graph/graphic_equalizer}
                    \end{figure}
                    \addreference{\href{https://en.wikipedia.org/wiki/File:Graphic_equalizer.jpg}{en.wikipedia.org/wiki/File:Graphic\_equalizer.jpg}}
                    }
                \only<2>{
                    \begin{figure}
                        \includegraphics[scale=.25]{graph/hum_removal}
                    \end{figure}}
                \only<3>{
                    \begin{figure}
                        \includegraphics[scale=.4]{graph/riaa_emphasis}
                    \end{figure}
                    \addreference{\href{https://www.learnabout-electronics.org/Amplifiers/images/RIAA-curve.gif}{learnabout-electronics.org/Amplifiers/images/RIAA-curve.gif}}
                    }
                \only<4>{
                    \figwithmatlab{LoudnessWeighting}}
                \only<5>{
                    \figwithmatlab{Smoothing}}
        \end{columns}
	\end{frame}
 
    \begin{frame}{filters}{reminder: system theory}
        \begin{itemize}
            \item output of a system (filter) $y$ computed by \textbf{convolution} of input $x$ and impulse response $h$
                \begin{equation*}
                    y(t) = x(t) \ast h(t)   
                \end{equation*}
            \bigskip
            \item<2-> this is equivalent to a frequency domain multiplication 
                \begin{eqnarray*}
                    Y(\jom) &=& X(\jom) \cdot H(\jom)\\
                    H(\jom) &=& \frac{Y(\jom)}{X(\jom)}
                \end{eqnarray*}
            \bigskip
            \item<3-> \textbf{transfer function} $H(\jom)$ is complex, often represented as 
                \begin{itemize}
                    \item \textbf{magnitude} $|H(\jom)|$ and 
                    \item phase $\Phi_\mathrm{H}(\jom)$
                \end{itemize}
        \end{itemize}
    \end{frame}
   
    \section{equalization}
	\begin{frame}{filters}{common transfer function shapes}
            \question{what are typical filters/spectral filter shapes}

            \begin{columns}
            \column{.4\linewidth}
            \begin{itemize}
                \item   very common:
                    \begin{itemize}
                        \item   low/high pass
                    \end{itemize}
                \smallskip
                \item<3->   common for non-audio/non-parametric:
                    \begin{itemize}
                        \item   band pass/band stop
                    \end{itemize}
                \smallskip
                \item<4->   also common in audio apps:
                    \begin{itemize}
                        \item<4->   low/high shelving
                        \item<5->   peak filter
                        \item<6->   resonance/notch
                    \end{itemize}
            \end{itemize}
            \column{.65\linewidth}
                \vspace{-3mm}
                \only<2-3>{
                    \begin{figure}%
                        \includegraphics[width=.6\columnwidth]{graph/generalfilters_overview}%
                    \end{figure}
                }
                \only<4>{
                    \begin{figure}%
                        \includegraphics[width=.4\columnwidth]{graph/filter_shelving}%
                    \end{figure}
                }
                \only<5>{
                    \begin{figure}%
                        \includegraphics[width=\columnwidth]{graph/filter_peak}%
                    \end{figure}
                }
                \only<6>{
                    \begin{figure}%
                        \includegraphics[width=.5\columnwidth]{graph/filter_notch}%
                    \end{figure}
                }
            \end{columns}
            \only<2-5>{\phantom{\footfullcite{zolzer_digital_2008}}}
    \end{frame}
	\begin{frame}{filters}{filters in series}
			\begin{figure}
				\centerline{\includegraphics[width=\linewidth]{graph/zolzer_filterchain}}
			\end{figure}
            \phantom{\footfullcite{zolzer_digital_2008}}
	\end{frame}
    \begin{frame}{filters}{filter banks --- parallel connections}
        \vspace{-3mm}
        \only<1>{
        \begin{figure}%
            \includegraphics[width=.5\columnwidth]{graph/filterbank}%
        \end{figure}
        }
        \vspace{-2mm}
        \only<2>{
        \begin{figure}%
            \includegraphics[width=.75\columnwidth]{graph/filterbank2}%
        \end{figure}
        }
            \phantom{\footfullcite{zolzer_digital_2008}}
    \end{frame}
    
\section{parameters}
        \begin{frame}{filters}{filter parameters --- lowpass/highpass}
            \vspace{-5mm}
            \begin{columns}
            \column{.5\linewidth}
                \begin{itemize}
                    \item   \textbf{cut-off} frequency $f_\mathrm{c}$
                        \begin{itemize}
                            \item   frequency marking the transition of pass to stop band
                            \item   \unit[-3]{dB} of pass band level
                        \end{itemize}
                    \smallskip
                    \item   \textbf{slope}/steepness
                        \begin{itemize}
                            \item   measured in dB/Octave or dB/Decade
                            \item   typically directly related to filter order
                        \end{itemize}
                    \smallskip
                    \item   sometimes: \textbf{resonance}    
                        \begin{itemize}
                            \item   level increase in narrow band around cut-off frequency
                        \end{itemize}
                \end{itemize}
            \column{.5\columnwidth}
                \begin{figure}%
                    \includegraphics[width=.9\columnwidth]{graph/filter_parameters_lowpass}%
                \end{figure}
                \addreference{\href{https://en.wikipedia.org/wiki/File:Butterworth_response.svg}{en.wikipedia.org/wiki/File:Butterworth\_response.svg}}
            \end{columns}
        \end{frame}
        \begin{frame}{filters}{filter parameters --- bandpass/bandstop}
            \begin{columns}
            \column{.5\linewidth}
                \begin{itemize}
                    \item   \textbf{center} frequency $f_\mathrm{c}$
                        \begin{itemize}
                            \item   frequency marking the center of the pass or stop band
                        \end{itemize}
                    \smallskip
                    \item   \textbf{bandwidth} $\Delta B$
                        \begin{itemize}
                            \item   width of the pass band
                            \item   at \unit[-3]{dB} of max pass band level
                        \end{itemize}
                    \smallskip
                    \item   possibly: \textbf{slope}    
                        \begin{itemize}
                            \item   typically directly related to filter order
                        \end{itemize}
                \end{itemize}
            \column{.5\columnwidth}
                \begin{figure}%
                    \includegraphics[width=.9\columnwidth]{graph/filter_parameters_bandpass}%
                \end{figure}
                \addreference{\href{https://en.wikipedia.org/wiki/File:Bandwidth_2.svg}{en.wikipedia.org/wiki/File:Bandwidth\_2.svg}}
            \end{columns}
        \end{frame}
        \begin{frame}{filters}{filter parameters --- peak}
            \begin{columns}
            \column{.5\linewidth}
                \begin{itemize}
                    \item   \textbf{center} frequency $f_\mathrm{c}$
                        \begin{itemize}
                            \item   frequency marking the center of the peak
                        \end{itemize}
                    \smallskip
                    \item   \textbf{Q factor} or \textbf{bandwidth} $\Delta B$
                        \begin{itemize}
                            \item   width of the bell
                            \item   at \unit[-3]{dB} of max gain
                            \[Q = \frac{f_\mathrm{c}}{\Delta B}\]
                        \end{itemize}
                    \smallskip
                    \item   \textbf{gain}    
                        \begin{itemize}
                            \item   amplification/attenuation in dB
                        \end{itemize}
                \end{itemize}
            \column{.5\columnwidth}
                \begin{figure}%
                    \includegraphics[width=.9\columnwidth]{graph/filter_parameters_peak}%
                \end{figure}
                \addreference{\href{http://www.sengpielaudio.com/FilterBandwidth09B.gif}{sengpielaudio.com/FilterBandwidth09B.gif}}
            \end{columns}
        \end{frame}
        \begin{frame}{filters}{filter parameters --- overview}
            \begin{footnotesize}
            \begin{table}%
            \begin{tabular}{l|ccccc}
                \textit{parameter} & \textbf{lowpass} & \textbf{low shelving} & \textbf{band pass} & \textbf{peak} & \textbf{resonance}\\ \hline
                \textit{frequency} &cut-off&cut-off&center&center&center\\
                \textit{bandwidth/Q} &res.\ gain&---&$\Delta B$& $Q$ &---\\
                %slope &dB/Oct&---&dB/Oct&---&---\\
                \textit{gain} &---&yes&---&yes&---
            \end{tabular}
            \end{table}
            \end{footnotesize}
        \end{frame}
        
\section{examples}	
	\begin{frame}{filters}{digital filter description}
		\begin{equation*}
			H(\mathrm{j}\omega) = \mathfrak{F}\{h(t)\}
		\end{equation*}


		filter is defined by its
		\begin{itemize}
			\item	complex transfer function $H(\mathrm{j}\omega)$, or its
			\item	impulse response $h(t)$, or its
			\item<2->	\textit{list of pole and zero positions in the Z-plane}
		\end{itemize}
	\end{frame}

	
	\begin{frame}{filters}{example 1}
        \setbeamercovered{invisible}

	        \begin{figure}
				\begin{center}
                \input{pict/filter_LP_FIR}
				\end{center}
	        \end{figure}
        
        	\pause
            \begin{equation*}
        		y(i) = 0.5\cdot x(i) + 0.5\cdot x(i-1)
        	\end{equation*}
	\end{frame}	
	
	\begin{frame}{filters}{example 1: transfer function 1/2}
    	\begin{eqnarray*}
	        		y(i) &=& 0.5\cdot x(i) + 0.5\cdot x(i-1)\\
	        		H(z) &=& 0.5  + 0.5\cdot z^{-1}\\
	       	\pause
	        		H(j\omega) &=& 0.5  + 0.5\cdot e^{-j\omega}\\
	       	\pause
	       			|H(j\omega)| &=&0.5 \cdot \left| e^{-j\frac{\omega}{2}} \cdot \left( e^{j\frac{\omega}{2}} + e^{-j\frac{\omega}{2}}\right)\right| \\
	       	\pause
	       				&=&0.5 \cdot \underbrace{\left| e^{-j\frac{\omega}{2}}\right|}_{1} \cdot  \underbrace{\left|\left( e^{j\frac{\omega}{2}} + e^{-j\frac{\omega}{2}}\right)\right|}_{\left| 2\cos\left(\frac{\omega}{2}\right) \right|} \\
	       	\pause
	       	&=& \left| \cos\left(\frac{\omega}{2}\right) \right|
    	\end{eqnarray*}
	\end{frame}	
	
	\begin{frame}{filters}{example 1: transfer function 2/2}
		\begin{figure}
			\centerline{\includegraphics[scale=.8]{SimpleFilter-LP_FIR}}
		\end{figure}
        \addreference{matlab source: \href{https://github.com/alexanderlerch/MUSI-6202/blob/main/matlab/plotSimpleFilter.m}{plotSimpleFilter.m}}
	\end{frame}	
	
	\begin{frame}{filters}{example 2}
        \setbeamercovered{invisible}
        \begin{figure}
			\begin{center}
                \input{pict/filter_HP_FIR}
			\end{center}
        \end{figure}
        \pause
    	\begin{eqnarray*}
    		y(i) &=& 0.5\cdot x(i) - 0.5\cdot x(i-1)\\
    		H(z) &=& 0.5  - 0.5\cdot z^{-1}\\
    	\pause
    		|H(j\omega)| &=& \left| \sin\left(\frac{\omega}{2}\right) \right|
    	\end{eqnarray*}
	\end{frame}	
	
	\begin{frame}{filters}{example 2: transfer function}
		\begin{figure}
			\centerline{\includegraphics[scale=.8]{SimpleFilter-HP_FIR}}
		\end{figure}
        \addreference{matlab source: \href{https://github.com/alexanderlerch/MUSI-6202/blob/main/matlab/plotSimpleFilter.m}{plotSimpleFilter.m}}
	\end{frame}	
	
	\begin{frame}{filters}{example 3}
        \setbeamercovered{invisible}
       \begin{figure}[!hbt]
			\begin{center}
                \input{pict/filter_CB_FIR}
			\end{center}
        \end{figure}
		\pause      
    	\begin{eqnarray*}
    		y(i) &=& 0.5\cdot x(i) - 0.5\cdot x(i-N)\\
    		H(z) &=& 0.5  - 0.5\cdot z^{-N}\\
			\pause
    		|H(j\omega)| &=& 0.5\cdot\left| e^{-j\frac{N\omega}{2}} \cdot \left(e^{j\frac{N\omega}{2}} - e^{-j\frac{N\omega}{2}} \right) \right|\\
			\pause
    		 &=& \left| \sin\left(\frac{N\omega}{2}\right) \right|
    	\end{eqnarray*}
	\end{frame}	
	
	\begin{frame}{filters}{example 3: transfer function}
		\begin{figure}
			\centerline{\includegraphics[scale=.8]{SimpleFilter-CB_FIR}}
		\end{figure}
        \addreference{matlab source: \href{https://github.com/alexanderlerch/MUSI-6202/blob/main/matlab/plotSimpleFilter.m}{plotSimpleFilter.m}}
	\end{frame}	
	
	\begin{frame}{filters}{example 4}
        \setbeamercovered{invisible}
        \begin{columns}
        \column{.6\linewidth}
        \begin{figure}
			\begin{center}
                \input{pict/filter_MA_FIR}
			\end{center}
        \end{figure}
        
        \column{.4\linewidth}
        \only<2>{
    	\begin{equation*}
    		y(i) = \frac{1}{\mathcal{J}}\sum_{j=0}^{\mathcal{J}-1} x(i-j)
    	\end{equation*}
        }
        \end{columns}
	\end{frame}
	\begin{frame}{filters}{example 4: transfer function}
        \vspace{-10mm}
        \begin{columns}
        \column{.7\linewidth}
		\begin{figure}
			\centerline{\includegraphics[scale=.8]{SimpleFilter-MA_FIR}}
		\end{figure}
        \addreference{matlab source: \href{https://github.com/alexanderlerch/MUSI-6202/blob/main/matlab/plotSimpleFilter.m}{plotSimpleFilter.m}}
        \column{.3\linewidth}
    	\begin{equation*}
    		H(j\omega) = e^{-\mathrm{j}\mathcal{J}\frac{\omega}{2}}\frac{\sin\left(\mathcal{J}\cdot\frac{\omega}{2} \right)}{\mathcal{J}\cdot\sin\left(\frac{\omega}{2} \right)}
    	\end{equation*}
        \end{columns}

	\end{frame}	
	\begin{frame}{filters}{example 4: recursive implementation}
		\begin{eqnarray*}
			y(i) &=& \sum\limits_{j=0}^{\mathcal{J}-1}{\frac{1}{\mathcal{J}}\cdot x(i-j)}\nonumber\\
			\pause
			&=& \frac{1}{\mathcal{J}}\cdot \big(x(i) - x(i-\mathcal{J})\big) + \underbrace{\sum\limits_{j=1}^{\mathcal{J}}{\frac{1}{\mathcal{J}}\cdot x(i-j)}}_{y(i-1)}\nonumber\\
			\pause
			&=& \frac{1}{\mathcal{J}}\cdot \big(x(i) - x(i-\mathcal{J})\big) + y(i-1) 
		\end{eqnarray*} 
		\pause
		\textcolor{gtgold}{not applicable with windowed coefficients!}
	\end{frame}
	\begin{frame}{filters}{example 5}
        \setbeamercovered{invisible}
	        \begin{figure}[!hbt]
				\begin{center}
                \input{pict/filter_LP_IIR}
				\end{center}
	        \end{figure}
            \pause
        	\begin{eqnarray*}
        		y(i) &=& (1-\alpha)\cdot x(i) + \alpha\cdot y(i-1)\\
        			&=& x(i) + \alpha \cdot (y(i-1) - x(i))
        	\end{eqnarray*}
	\end{frame}
	
	\begin{frame}{Example 5: transfer function 1/2}
    	\begin{eqnarray*}
        		y(i) &=& (1-\alpha)\cdot x(i) + \alpha\cdot y(i-1)\\
        		H(z) &=& \frac{1-\alpha}{1-\alpha z^{-1}}\\
        \pause
        		H(j\omega) &=& \frac{1-\alpha}{1-\alpha e^{-j\omega}}\\
        \pause
        		|H(j\omega)| &=& \left|\frac{1-\alpha}{1-\alpha e^{-j\omega}}\right| \\
        \pause
        		&=&\frac{1-\alpha}{\sqrt{\left(1 + \alpha^2 - 2\alpha\cos(\omega)\right)}} 
    	\end{eqnarray*}
	\end{frame}
	\begin{frame}{filters}{example 5: transfer function 2/2}
		\begin{figure}
			\centerline{\includegraphics[scale=.8]{SimpleFilter-LP_IIR}}
		\end{figure}
        \addreference{matlab source: \href{https://github.com/alexanderlerch/MUSI-6202/blob/main/matlab/plotSimpleFilter.m}{plotSimpleFilter.m}}
	\end{frame}
	\begin{frame}{filters}{example 6}
        \begin{figure}[!hbt]
			\begin{center}
                \input{pict/filter_CB_IIR}
			\end{center}
        \end{figure}
    	\begin{equation*}
    		y(i) = b_0\cdot x(i) - a_N\cdot y(i-N)
    	\end{equation*}
	\end{frame}
	\begin{frame}{filters}{example 6: transfer function}
        \vspace{-10mm}
        \begin{columns}
        \column{.7\linewidth}
		\begin{figure}
			\centerline{\includegraphics[scale=.8]{SimpleFilter-CB_IIR}}
		\end{figure}
        \addreference{matlab source: \href{https://github.com/alexanderlerch/MUSI-6202/blob/main/matlab/plotSimpleFilter.m}{plotSimpleFilter.m}}
        \column{.3\linewidth}
    	\begin{equation*}
    		H(j\omega) = \frac{b_0}{1-a_N\cdot e^{-j\omega N}}
    	\end{equation*}
        \end{columns}
	\end{frame}
	\begin{frame}{filters}{biquad: structure}
        \vspace{-3mm}
		\begin{figure}
			\centerline{\includegraphics[scale=.3]{graph/general_biquad_jos}}
		    \label{fig:general_biquad}
		\end{figure}
		\pause
		\vspace{-3mm}
		\begin{eqnarray*}
			\text{diff eq}: y(i) 	&=& \sum_{k=0}^{K_1}{b_k\cdot x(i-k)} + \sum_{k=1}^{K_2}{-a_k\cdot y(i-k)} \nonumber\\
			\text{trans. fct}: H(z) 	&=& \frac{Y(z)}{X(z)} =  \frac{\sum_{k=0}^{K_1}{b_k\cdot z^{-k}}}{1 + \sum_{k=1}^{K_2}{a_k\cdot z^{-k}}} 
		\end{eqnarray*}
	\end{frame}

	\section{summary}	
        \begin{frame}{filters}{summary}
            \vspace{-3mm}
            \begin{itemize}
                \item   filter (equalization) can be used for various tasks
                    \begin{itemize}
                        \item   changing the sound quality of a signal
                        \item   hiding unwanted frequency components
                        \item   smoothing
                        \item   processing for measurement and transmission
                    \end{itemize}
                \item<2->   most common audio filter types are
                    \begin{itemize}
                        \item   low/high pass
                        \item   peak
                        \item   shelving
                    \end{itemize}
                \item<3->   filter parameters include
                    \begin{itemize}
                        \item   frequency (mid, cutoff)
                        \item   bandwidth or Q
                        \item   gain
                    \end{itemize}
                \item<4->   filter orders
                    \begin{itemize}
                        \item   typical orders are 1st, 2nd, maybe 4th
                        \item   higher order give more flexibility wrt transfer function
                        \item   higher orders are difficult to design and control
                        \item   higher orders can be split into multiple low order filters
                    \end{itemize}
            \end{itemize}
        \end{frame}
 

\end{document}

